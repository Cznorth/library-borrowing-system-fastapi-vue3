version: '3.9'
services:
  backend:
    build: ./backend
    environment:
      - SQLALCHEMY_DATABASE_URI=${SQLALCHEMY_DATABASE_URI}
      - JWT_SECRET_KEY=change-me
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command: sh -c "alembic upgrade head && uvicorn app.main:app --host 0.0.0.0 --port 8000"
    ports:
      - '8000:8000'

  frontend:
    build: ./frontend
    environment:
      - VITE_API_PROXY_TARGET=http://backend:8000
    ports:
      - '5173:5173'
